{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}" type="image/x-icon">
    <title>User Login</title>
    <style>
        .section_button {
            border: none;
            border-radius: 45px;
            background-color: #edffef;
            color: white;
            padding: 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 30px;
            margin: auto;
            cursor: pointer;
        }
        .section_logo {
            background-color: #edffef;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 30px;
            margin: auto;
            cursor: pointer;
            vertical-align: middle;
            width: 120px;
            height: 120px;
        }
        #container {
            width: 520px;
            margin: 10px auto;
        }
        .input {
            display: block;
            text-align: center;
            margin: 1px auto;
            height: 50px;
        }
        .small_button {
            background-color: #025769;
            border: none;
            color: white;
            padding: 4px 8px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 20px;
            margin: auto;
            cursor: pointer;
        }
        .hint {
            color: red;
            font-size: 14px;
        }
        a, a:hover, a:visited, a:active {
            color: inherit;
            text-decoration: none;
        }
    </style>
</head>
<body>
    {% csrf_token %}

    <div style="text-align: center">
        <br>
        <br>
        <button type="button" class="section_button">
            <img src="{% static 'account/login.png' %}" class="section_logo">
        </button>
    </div>

    <div id="container">
        <hr>
        <form>
            <fieldset>
                <legend style="font-family: Trebuchet MS"><b>User Information</b></legend>
                <br>
                <div class="input">
                    <label style="font-family: Courier New"><b>Username</b></label>
                    &nbsp;&nbsp;
                    <input type="text" v-model="username">
                </div>
                <div class="input">
                    <label style="font-family: Courier New"><b>Password</b></label>
                    &nbsp;&nbsp;
                    <input type="password" v-model="password">
                </div>
                <div class="input">
                    <label style="font-family: Courier New"><b>Captcha&nbsp;</b></label>
                    &nbsp;&nbsp;
                    <input type="text" v-model="captcha">
                </div>
                <div style="text-align: center">
                    <img :src="imgCode" alt="" style="width:264px; height:50px;">
                </div>
            </fieldset>
            <div style="text-align: center; margin-top: 15px">
                <input type="button" value="Login" @click.prevent="login" class="small_button">
            </div>
        </form>
        <div style="text-align: right">
            <a href="/account/register/"
               style="background-color: #fff2ec; font-family: Trebuchet MS">Register</a>
        </div>
    </div>

    <script src="https://unpkg.com/vue@2.6.12/dist/vue.min.js"></script>
    <script>
        let app = new Vue({
            el: '#container',
            data: {
                imgCode: '/account/api/captcha/',
                username: '',
                password: '',
                captcha: ''
            },
            methods: {
                login() {
                    fetch('/account/api/login/', {
                        method: 'post',
                        body: JSON.stringify({
                            'username': this.username,
                            'password': this.password,
                            'captcha': this.captcha
                        }),
                        headers: {
                            'content-type': 'application/json',
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                        }
                    }).then(resp => resp.json()).then(json => {
                        if (json.code === 10000) {
                            location.href = '/'
                        } else {
                            alert(json.mesg),
                            this.imgCode += '?',
<!--                            this.username = '',-->
<!--                            this.password = '',-->
                            this.captcha = ''
                        }
                    })
                }
            }
        })
    </script>
</body>
</html>